<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
      integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<link href="https://s3-us-west-2.amazonaws.com/colors-css/2.2.0/colors.min.css" rel="stylesheet">
<link href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css" rel="stylesheet">
<link rel="stylesheet" href="/stylesheets/custom.css">

<div aria-live="polite" aria-atomic="true" style="position: relative; min-height: 200px;" role="alert">
    <h1>{{title}}</h1>
    <p>Welcome to {{title}}</p>
    <h5>User List</h5>

    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true"
         style="position: absolute; top: 0; right: 0;" data-delay="10000">
        <div class="toast-header bg-primary text-white">
            <img src="https://2.bp.blogspot.com/-Ug8Wa5CJUYQ/X_iXJl01ElI/AAAAAAAAANQ/_TMWekaqRJsMsQErPLAnWqljtdBRvci_QCK4BGAYYCw/s1600/fav-logo-v3.png"
                 width="20" class="rounded mr-2" alt="logo">
            <strong class="mr-auto">Atz</strong>
            <small>11 mins ago</small>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="toast-body bg-light text-dark">
            Hello, world! This is a toast message.
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="text-small">
                <span class="badge badge-pill badge-success bg-green">promo</span>
                <span class="badge badge-pill badge-primary bg-blue">special</span>
                <span class="badge badge-pill badge-warning bg-orange">best</span>
                <span class="badge badge-pill badge-warning bg-yellow">breed</span>
                <span class="badge badge-pill badge-danger bg-red">junior</span>
                <span class="badge badge-pill badge-light">default</span>
            </div>
            <div id="toolbar">
                <button id="button" class="btn btn-primary bg-purple"><i class="fa fa-eye"></i> View data</button>
                <button id="button2" class="btn btn-secondary">insertRow</button>
                <button id="button3" class="btn btn-secondary">updateRow</button>
                <button id="button4" class="btn btn-danger">remove</button>
                <button id="button5" class="btn btn-primary">refresh</button>
            </div>
            <table
                    id="table"
                    data-toggle="table"
                    data-show-print="true"
                    data-show-refresh="true"
                    data-toolbar="#toolbar"
                    data-height="650"
                    data-ajax="ajaxRequest"
                    data-search="true"
                    data-custom-search="customSearch"
                    data-single-select="true"
                    data-click-to-select="true"
                    data-side-pagination="client"
                    data-pagination="true"
                    data-page-size="25"
                    data-row-style="rowStyle">
                <thead>
                <tr>
                    <th data-field="state" data-checkbox="true"></th>
                    <th data-field="id" data-visible="false">ID</th>
                    <th data-field="itemCode" data-width="100">Item Code</th>
                    <th data-field="firstName">First Name</th>
                    <th data-field="lastName">Last Name</th>
                    <th data-field="isActive" data-formatter="isActiveFormatter" data-width="100">Is Active</th>
                    <th data-field="description" data-visible="false">Description</th>
                </tr>
                </thead>
            </table>
        </div>
    </div>

    <div class="modal fade" id="formModal" tabindex="-1" role="dialog" aria-labelledby="formModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="formModalLabel">Data User: </h5>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <figure class="figure">
                            <img src="https://1.bp.blogspot.com/-epBFz5TdmXk/YCQlXYID2hI/AAAAAAAAAPM/2L_QXRZQLbM_vPaDF85lDR3y1tHkQ78lACLcBGAsYHQ/s320/giant-01.jpg"
                                 width="250" class="figure-img img-fluid rounded" alt="...">
                            <figcaption class="figure-caption text-center text-small text-info"><small>A caption for the
                                above image.</small></figcaption>
                        </figure>
                    </div>
                    <form>
                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isActive" value="1">
                                <label class="form-check-label" for="isActive">
                                    Is Active
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="itemCode" class="col-form-label">Item Code:</label>
                            <input type="hidden" class="form-control" id="itemId" value="">
                            <input type="text" class="form-control" id="itemCode">
                        </div>
                        <div class="form-group">
                            <label for="roleItem">Example multiple select</label>
                            <select class="form-control" id="roleItem">
                              <option value="default">default</option>
                              <option value="promo">promo</option>
                              <option value="special">special</option>
                              <option value="best">best</option>
                              <option value="breed">breed</option>
                              <option value="junior">junior</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="firstName" class="col-form-label">First Name:</label>
                            <input type="text" class="form-control" id="firstName">
                        </div>
                        <div class="form-group">
                            <label for="lastName" class="col-form-label">Last Name:</label>
                            <input type="text" class="form-control" id="lastName">
                        </div>
                        <div class="form-group">
                            <label for="description" class="col-form-label">Description:</label>
                            <textarea class="form-control" rows="3" id="description"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnUp">Update</button>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/extensions/print/bootstrap-table-print.min.js"></script>

<script>
    $(function () {

        $('#table').bootstrapTable({
            formatSearch: function () {
                return 'Search First Name'
            }
        })

        $('.toast').toast('show')

        $('#formModal').on('hidden.bs.modal', function () {
            $('.toast').toast('show')
        })

        $('#button').click(function () {
            var data = $('#table').bootstrapTable('getSelections');
            viewData(data)
        })

        $('#button2').click(function () {
            var randomId = 100 + ~~(Math.random() * 100)
            $('#table').bootstrapTable('insertRow', {
                index: 1,
                row: {
                    id: randomId,
                    firstName: 'firstName ' + randomId,
                    lastName: 'lastName-' + randomId
                }
            })
        })

        $('#button3').click(function () {
            var randomId = 100 + ~~(Math.random() * 100)
            var selected = $('#table').bootstrapTable('getSelections');
            console.log(selected);
            $('#table').bootstrapTable('updateRow', {
                index: 1,
                row: {
                    id: randomId,
                    firstName: 'firstName ' + randomId,
                    lastName: 'lastName-' + randomId
                }
            })
        })

        $('#button4').click(function () {
            var ids = $.map($('#table').bootstrapTable('getSelections'), function (row) {
                console.log(row);
                return row.id
            })
            console.log(ids);
            $('#table').bootstrapTable('remove', {
                field: 'id',
                values: ids
            })
        })

        $('#button5').click(function () {
            $('#table').bootstrapTable('refresh')
        })

        $('#btnUp').click(function () {
            ajaxUp()
        })
})

    function ajaxUp() {
        var itemId = $('#itemId').val()
        console.log($('#isActive').prop('checked'))
        var url = '/users/' + itemId
        $.ajax({
            type: "Patch",
            url: url,
            data: {
                id: itemId,
                isActive: $('#isActive').prop('checked') ? 1 : 0,
                itemCode: $('#itemCode').val(),
                firstName: $('#firstName').val(),
                lastName: $('#lastName').val(),
                description: $('#description').val(),
                roleItem: $('#roleItem').val()
            },
            success: function (data) {
                //console.log(data)
                $('#formModal').modal('hide')
                $('#itemId,#itemCode,#lastName,#description').val('')
                $('#isActive').prop('checked', false)
                $('#table').bootstrapTable('refresh')
            }
        })
    }

    function viewData(data) {
        $('#formModal').find('.modal-title').text('Data user: ' + '[' + data[0].id + '] ' + data[0].firstName)
        $('#itemId').val(data[0].id)
        $('#isActive').prop('checked', data[0].isActive)
        $('#itemCode').val(data[0].itemCode)
        $('#firstName').val(data[0].firstName)
        $('#lastName').val(data[0].lastName)
        $('#description').val(data[0].description)
        $('#roleItem').val(data[0].roleItem)
        $('#formModal').modal('show')
    }

    // your custom ajax request here
    function ajaxRequest(params) {
        var url = '/users/'
        $.get(url + '?' + $.param(params.data)).then(function (res) {
            params.success(res)
        })
    }

    function customSearch(data, text) {
        return data.filter(function (row) {
            return row.firstName.indexOf(text) > -1 | row.lastName.indexOf(text) > -1
        })
    }

    function isActiveFormatter(value, row) {
        var icon = value === 1 ? 'fa-star' : 'fa-star-and-crescent'
        var text = value === 1 ? 'Active' : 'Hidden'
        return '<i class="fa ' + icon + '"></i> ' + text
    }

    function rowStyle(row, index) {
        var classes = [
            'bg-green',
            'bg-blue',
            'bg-orange',
            'bg-yellow',
            'bg-red'
        ]

        if (row.roleItem === 'promo') {
            return {
                classes: classes[0]
            }
        }
        if (row.roleItem === 'special') {
            return {
                classes: classes[1]
            }
        }
        if (row.roleItem === 'best') {
            return {
                classes: classes[2]
            }
        }
        if (row.roleItem === 'breed') {
            return {
                classes: classes[3]
            }
        }
        if (row.roleItem === 'junior') {
            return {
                classes: classes[4]
            }
        }

        return {
            css: {
                color: 'blue'
            }
        }
    }
</script>